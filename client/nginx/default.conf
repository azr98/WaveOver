server {
listen 80;
server_name dev.waveover.info;
# Frontend routing: serve index.html for SPA routes
location / {
root /usr/share/nginx/html;
index index.html;
try_files $uri /index.html;
}
# Proxy API requests to backend ALB using HTTPS
location /api/ {
# Use https so that TLS/SSL is properly terminated by the ALB
proxy_pass https://devbackend.waveover.info;
# Set the headers expected by your backend
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_ssl_server_name on; # Enable SNI for proper TLS negotiation
# Handle OPTIONS preflight requests
if ($request_method = OPTIONS) {
add_header Access-Control-Allow-Origin "https://dev.waveover.info" always;
add_header Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE" always;
add_header Access-Control-Allow-Headers "Origin, Content-Type, Accept, Authorization" always;
add_header Access-Control-Max-Age 1728000;
add_header Content-Length 0;
add_header Content-Type "text/plain; charset=UTF-8";
return 204;
}
# For non-OPTIONS requests, make sure CORS headers are added
proxy_hide_header Access-Control-Allow-Origin;
add_header Access-Control-Allow-Origin "https://dev.waveover.info" always;
add_header Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE" always;
add_header Access-Control-Allow-Headers "Origin, Content-Type, Accept, Authorization" always;
# Timeouts to prevent upstream errors
proxy_connect_timeout 60;
proxy_send_timeout 60;
proxy_read_timeout 60;
send_timeout 60;
}
# Enable gzip compression
gzip on;
gzip_vary on;
gzip_min_length 10240;
gzip_proxied expired no-cache no-store private auth;
gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml;
gzip_disable "MSIE [1-6]\\.";
}
